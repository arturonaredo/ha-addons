name: "VoltAssistant"
description: "Smart battery and load management for Deye/Solarman inverters. PVPC price optimization, tariff periods, and priority-based load shedding."
version: "1.5.0"
slug: "voltassistant"
url: "https://github.com/arturonaredo/ha-addons"
arch:
  - amd64
  - aarch64
  - armv7
startup: application
boot: auto
init: false
ingress: true
ingress_port: 8099
panel_icon: "mdi:flash"
panel_title: "VoltAssistant"

options:
  inverter:
    max_power: 6000
    battery_capacity_kwh: 32.6
    battery_min_soc: 10
    battery_max_soc: 100
  
  sensors:
    battery_soc: "sensor.predbat_battery_soc_2"
    battery_power: "sensor.inverter_battery_power"
    battery_capacity: "sensor.inverter_battery_capacity"
    grid_power: "sensor.inverter_grid_power"
    load_power: "sensor.inverter_load_power"
    pv_power: "sensor.inverter_pv_power"
    pvpc_price: "sensor.esios_pvpc_octopus3"
    tariff_period: "sensor.predbat_periodo_potencia"
  
  controls:
    work_mode: "select.inverter_work_mode"
    grid_charge_start_soc: "number.inverter_battery_grid_charging_start"
    program_1_soc: "number.inverter_program_1_soc"
    program_1_time: "time.inverter_program_1_time"
    program_2_soc: "number.inverter_program_2_soc"
    program_2_time: "time.inverter_program_2_time"
  
  tariff_periods:
    valle:
      hours: "00:00-08:00"
      contracted_power_kw: 6.9
      charge_battery: true
      target_soc: 100
    llano:
      hours: "08:00-10:00,14:00-18:00,22:00-00:00"
      contracted_power_kw: 3.45
      charge_battery: false
      target_soc: 50
    punta:
      hours: "10:00-14:00,18:00-22:00"
      contracted_power_kw: 3.45
      charge_battery: false
      target_soc: 20
  
  loads: []
  
  ev_charging:
    enabled: false
    car_soc_sensor: "predbat.car_soc"
    car_charging_slot: "binary_sensor.predbat_car_charging_slot"
    charge_in_valle: true
    max_charge_power_kw: 7.4
    target_soc: 80
    smart_plan_time: "07:30"
  
  load_manager:
    enabled: true
    safety_margin_percent: 10
    check_interval_seconds: 30
  
  battery_optimization:
    enabled: true
    min_soc: 10
    default_target_soc: 80
    always_charge_below_price: 0.05
    never_charge_above_price: 0.15
    keep_full_weekends: true

schema:
  inverter:
    max_power: "int(1000,50000)"
    battery_capacity_kwh: "float(1,200)"
    battery_min_soc: "int(0,50)"
    battery_max_soc: "int(50,100)"
  
  sensors:
    battery_soc: "str"
    battery_power: "str"
    battery_capacity: "str?"
    grid_power: "str"
    load_power: "str"
    pv_power: "str"
    pvpc_price: "str"
    tariff_period: "str?"
  
  controls:
    work_mode: "str?"
    grid_charge_start_soc: "str?"
    program_1_soc: "str?"
    program_1_time: "str?"
    program_2_soc: "str?"
    program_2_time: "str?"
  
  tariff_periods:
    valle:
      hours: "str"
      contracted_power_kw: "float(0,20)"
      charge_battery: "bool"
      target_soc: "int(0,100)"
    llano:
      hours: "str"
      contracted_power_kw: "float(0,20)"
      charge_battery: "bool"
      target_soc: "int(0,100)"
    punta:
      hours: "str"
      contracted_power_kw: "float(0,20)"
      charge_battery: "bool"
      target_soc: "int(0,100)"
  
  loads:
    - id: "str"
      name: "str"
      priority: "list(essential|comfort|accessory)"
      power_sensor: "str?"
      switch_entity: "str?"
      max_power: "int(0,50000)?"
  
  ev_charging:
    enabled: "bool"
    car_soc_sensor: "str?"
    car_charging_slot: "str?"
    charge_in_valle: "bool"
    max_charge_power_kw: "float(0,22)?"
    target_soc: "int(0,100)?"
    smart_plan_time: "str?"
  
  load_manager:
    enabled: "bool"
    safety_margin_percent: "int(0,50)"
    check_interval_seconds: "int(5,300)"
  
  battery_optimization:
    enabled: "bool"
    min_soc: "int(0,50)"
    default_target_soc: "int(50,100)"
    always_charge_below_price: "float(0,0.5)"
    never_charge_above_price: "float(0,0.5)"
    keep_full_weekends: "bool"

map:
  - config:rw
